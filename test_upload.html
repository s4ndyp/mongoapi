<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G2 Gateway File Upload Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0f172a; color: #94a3b8; font-family: sans-serif; }
        .card { background: #1e293b; border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; }
        input, select { background: #0f172a !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; }
        .btn-primary { background: #6366f1; color: white; transition: all 0.2s; }
        .btn-primary:hover { background: #4f46e5; transform: translateY(-1px); }
        pre { background: #000; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.8rem; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="card w-full max-w-lg p-8 shadow-2xl">
        <div class="mb-8">
            <h1 class="text-2xl font-bold text-white mb-2">G2 File Upload Test</h1>
            <p class="text-sm">Test de Gateway file-handler vanaf een externe client.</p>
        </div>

        <div class="space-y-4">
            <div>
                <label class="block text-xs font-bold uppercase tracking-wider mb-2">Gateway URL</label>
                <input type="text" id="gateway-url" class="w-full p-3 rounded-lg outline-none focus:border-indigo-500" placeholder="http://10.10.2.20:5000">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wider mb-2">Endpoint</label>
                    <input type="text" id="endpoint" class="w-full p-3 rounded-lg outline-none focus:border-indigo-500" value="test_files">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wider mb-2">Client ID</label>
                    <input type="text" id="client-id" class="w-full p-3 rounded-lg outline-none focus:border-indigo-500" value="tester_123">
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold uppercase tracking-wider mb-2">Selecteer Bestand</label>
                <input type="file" id="file-input" class="w-full p-2 rounded-lg cursor-pointer">
            </div>

            <button onclick="uploadFile()" id="upload-btn" class="w-full py-4 rounded-xl btn-primary font-bold shadow-lg shadow-indigo-500/20">
                Start Upload
            </button>
        </div>

        <div id="result-container" class="mt-8 hidden">
            <label class="block text-xs font-bold uppercase tracking-wider mb-2">Resultaat</label>
            <div id="status-badge" class="inline-block px-3 py-1 rounded-full text-[10px] font-bold mb-3"></div>
            <pre id="response-output"></pre>
            
            <div id="link-container" class="mt-4 hidden">
                <a id="download-link" target="_blank" class="text-indigo-400 hover:text-indigo-300 text-sm font-bold underline">
                    Bekijk ge√ºpload bestand &rarr;
                </a>
            </div>
        </div>
    </div>

    <script>
        // Automatisch de URL invullen als we vanaf de server draaien
        if (window.location.origin.startsWith('http')) {
            document.getElementById('gateway-url').value = window.location.origin;
        }

        async function uploadFile() {
            const btn = document.getElementById('upload-btn');
            const fileInput = document.getElementById('file-input');
            const gatewayUrl = document.getElementById('gateway-url').value.replace(/\/$/, '');
            const endpoint = document.getElementById('endpoint').value;
            const clientId = document.getElementById('client-id').value;
            
            const resultContainer = document.getElementById('result-container');
            const statusBadge = document.getElementById('status-badge');
            const output = document.getElementById('response-output');
            const linkContainer = document.getElementById('link-container');
            const downloadLink = document.getElementById('download-link');

            if (!fileInput.files[0]) {
                alert("Selecteer eerst een bestand!");
                return;
            }

            btn.disabled = true;
            btn.innerText = "Bezig met uploaden...";
            resultContainer.classList.remove('hidden');
            output.innerText = "Verzenden...";
            linkContainer.classList.add('hidden');

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const url = `${gatewayUrl}/api/${endpoint}/files`;
                console.log("Uploading to:", url);

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'x-client-id': clientId
                    },
                    body: formData
                });

                const result = await response.json();
                
                statusBadge.innerText = response.ok ? `SUCCESS ${response.status}` : `ERROR ${response.status}`;
                statusBadge.className = response.ok ? 
                    "inline-block px-3 py-1 rounded-full text-[10px] font-bold mb-3 bg-emerald-500/10 text-emerald-500" : 
                    "inline-block px-3 py-1 rounded-full text-[10px] font-bold mb-3 bg-red-500/10 text-red-500";

                output.innerText = JSON.stringify(result, null, 2);

                if (response.ok && result.url) {
                    linkContainer.classList.remove('hidden');
                    downloadLink.href = result.url;
                }

            } catch (error) {
                statusBadge.innerText = "NETWORK ERROR";
                statusBadge.className = "inline-block px-3 py-1 rounded-full text-[10px] font-bold mb-3 bg-red-500/10 text-red-500";
                output.innerText = error.message;
            } finally {
                btn.disabled = false;
                btn.innerText = "Start Upload";
            }
        }
    </script>
</body>
</html>
